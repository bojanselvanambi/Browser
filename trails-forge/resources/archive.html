<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archive</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #121212;
            color: #E0E0E0;
            padding: 40px;
            min-height: 100vh;
        }

        h1 {
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 32px;
            color: #FC93AD;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .btn {
            background: #2a2a2a;
            color: #E0E0E0;
            border: 1px solid #444444;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn:hover {
            background: #3a3a3a;
        }



        .archive-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .archive-item {
            background: #1E1E1E;
            border-radius: 8px;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .archive-item:hover {
            background: #2a2a2a;
        }

        .archive-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            min-width: 0;
        }

        .archive-emoji {
            font-size: 18px;
            flex-shrink: 0;
        }

        .archive-details {
            flex: 1;
            min-width: 0;
        }

        .archive-title {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .archive-url {
            font-size: 12px;
            color: #888;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .archive-date {
            font-size: 12px;
            color: #888;
            margin-right: 12px;
        }

        .action-btn {
            background: #2a2a2a;
            border: none;
            color: #E0E0E0;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .action-btn:hover {
            background: #3a3a3a;
        }

        .action-btn.restore {
            background: #FC93AD;
            color: #121212;
        }

        .action-btn.restore:hover {
            background: #FDA1B8;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-illustration {
            margin-bottom: 24px;
        }

        .empty-state h2 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #FC93AD;
        }

        .empty-state p {
            color: #666;
        }
    </style>
</head>

<body>
    <h1>
        <!-- Archive scribble icon -->
        <svg width="28" height="28" viewBox="0 0 28 28" fill="none">
            <path d="M4 8 Q 14 4, 24 8" stroke="#FC93AD" stroke-width="2" stroke-linecap="round" fill="none" />
            <path d="M4 14 Q 14 10, 24 14" stroke="#FC93AD" stroke-width="2" stroke-linecap="round" fill="none"
                opacity="0.7" />
            <path d="M4 20 Q 14 16, 24 20" stroke="#FC93AD" stroke-width="2" stroke-linecap="round" fill="none"
                opacity="0.4" />
        </svg>
        Archive
    </h1>

    <div class="header-actions">
        <button class="btn" onclick="clearAllArchive()">Clear All</button>
    </div>

    <div id="archive-list" class="archive-list">
        <!-- Items will be rendered here -->
    </div>

    <script>
        let archivedTrails = [];

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + ' min ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + ' hours ago';
            if (diff < 604800000) return Math.floor(diff / 86400000) + ' days ago';

            return date.toLocaleDateString();
        }

        function renderArchive() {
            const container = document.getElementById('archive-list');

            if (archivedTrails.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-illustration">
                            <!-- Folder/box scribble illustration -->
                            <svg width="80" height="60" viewBox="0 0 80 60" fill="none">
                                <path d="M10 50 L10 25 Q10 20, 15 20 L30 20 L35 15 L65 15 Q70 15, 70 20 L70 50 Q70 55, 65 55 L15 55 Q10 55, 10 50" 
                                    stroke="#FC93AD" stroke-width="2.5" stroke-linecap="round" fill="none"/>
                                <path d="M20 35 Q 30 30, 40 35 S 55 40, 60 35" 
                                    stroke="#FC93AD" stroke-width="2" stroke-linecap="round" fill="none" opacity="0.5"/>
                            </svg>
                        </div>
                        <h2>No archived trails</h2>
                        <p>Closed trails will appear here</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = archivedTrails.map(trail => {
                // Get data from rootNode if available (closed trail structure)
                const node = trail.rootNode || trail;
                const title = node.title || 'Untitled';
                const url = node.url || '';
                const emoji = node.emoji || '';
                const favicon = node.favicon || '';

                return `
                <div class="archive-item" onclick="restoreTrail('${trail.id}')">
                    <div class="archive-info">
                        ${favicon ? `<img src="${favicon}" alt="" style="width: 16px; height: 16px; flex-shrink: 0;">` : (emoji ? `<span class="archive-emoji">${emoji}</span>` : '<span class="archive-emoji">ðŸ“„</span>')}
                        <div class="archive-details">
                            <div class="archive-title">${title}</div>
                            <div class="archive-url">${url}</div>
                        </div>
                    </div>
                    <span class="archive-date">${formatDate(trail.closedAt)}</span>
                    <button class="action-btn restore" onclick="event.stopPropagation(); restoreTrail('${trail.id}')">Restore</button>
                    <button class="action-btn" onclick="event.stopPropagation(); deleteTrail('${trail.id}')" style="margin-left: 8px">Delete</button>
                </div>
            `;
            }).join('');
        }

        function restoreTrail(id) {
            if (window.archiveAPI) {
                window.archiveAPI.restore(id);
            }
        }

        function deleteTrail(id) {
            archivedTrails = archivedTrails.filter(t => t.id !== id);
            renderArchive();
            if (window.archiveAPI) {
                window.archiveAPI.delete(id);
            }
        }

        function clearAllArchive() {
            if (confirm('Are you sure you want to clear all archived trails?')) {
                archivedTrails = [];
                renderArchive();
                if (window.archiveAPI) {
                    window.archiveAPI.clearAll();
                }
            }
        }

        // Get archived trails from main process
        if (window.archiveAPI) {
            window.archiveAPI.getArchive().then(data => {
                archivedTrails = data || [];
                renderArchive();
            });
        } else {
            renderArchive();
        }
    </script>
</body>

</html>